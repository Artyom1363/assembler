     1                                      section .data ; сегмент инициализированных переменных
     2 00000000 456E746572206D6174-     getMatr db "Enter matrix 6x4: ", 10
     2 00000009 726978203678343A20-
     2 00000012 0A                 
     3                                  lenGetMatr equ $-getMatr
     4                                  
     5 00000013 4E756D626572206F66-     outMes db "Number of string with maxim sum of positive numbers: "
     5 0000001C 20737472696E672077-
     5 00000025 697468206D6178696D-
     5 0000002E 2073756D206F662070-
     5 00000037 6F736974697665206E-
     5 00000040 756D626572733A20   
     6                                  lenOutMes equ $-outMes
     7                                  
     8 00000048 53756D206F6620706F-     outMesSum  db "Sum of positive numbers: "
     8 00000051 736974697665206E75-
     8 0000005A 6D626572733A20     
     9                                  lenOutMesSum equ $-outMesSum
    10                                  
    11 00000061 6572726F7220776869-     errorGetElem db "error while getting input", 10
    11 0000006A 6C652067657474696E-
    11 00000073 6720696E7075740A   
    12                                  lenErrorGetElem equ $-errorGetElem
    13                                  
    14                                      section .bss ; сегмент неинициализированных переменных
    15                                  
    16 00000000 <res 0000000A>          InBuf resb 10 ; буфер для вводимой строки
    17                                  lenIn equ $-InBuf
    18 0000000A <res 0000000A>          OutBuf resb 10
    19 00000014 <res 00000030>          matr resw 24
    20 00000044 <res 00000002>          bestQuantity resw 1
    21 00000046 <res 00000002>          numberOfBest resw 1
    22                                  
    23                                      section .text
    24                                      global  _start
    25                                  _start:
    26                                      ;write message
    27 00000000 B804000000                  mov eax, 4
    28 00000005 BB01000000                  mov ebx, 1
    29 0000000A B9[00000000]                mov ecx, getMatr 
    30 0000000F BA13000000                  mov edx, lenGetMatr
    31 00000014 CD80                        int 80h
    32                                  
    33 00000016 B918000000                  mov ecx, 24
    34 0000001B BB00000000                  mov ebx, 0
    35                                  
    36                                  cycle_read:
    37 00000020 51                          push ecx
    38 00000021 53                          push ebx
    39 00000022 B803000000                  mov eax, 3
    40 00000027 BB00000000                  mov ebx, 0
    41 0000002C B9[00000000]                mov ecx, InBuf
    42 00000031 BA0A000000                  mov edx, lenIn
    43 00000036 CD80                        int 80h
    44                                  
    45                                      ; convert number to int 
    46 00000038 BE[00000000]                mov esi, InBuf
    47 0000003D E8(00000000)                call StrToInt
    48 00000042 83FB00                      cmp ebx, 0
    49 00000045 0F8502010000                jne errorMessage
    50 0000004B 5B                          pop ebx
    51 0000004C 668983[14000000]            mov [matr + ebx], ax
    52 00000053 59                          pop ecx
    53 00000054 83C302                      add ebx, 2
    54 00000057 E2C7                        loop cycle_read
    55                                  
    56                                  
    57                                  
    58                                  ;logic
    59                                  ; ax - sum, bx - number
    60 00000059 B906000000                  mov ecx, 6
    61 0000005E BB00000000                  mov ebx, 0
    62                                  
    63                                  loop_i:
    64 00000063 51                          push ecx
    65 00000064 B800000000                  mov eax, 0
    66 00000069 B904000000                  mov ecx, 4
    67                                  
    68                                  loop_j:
    69 0000006E 66BA0000                    mov dx, 0   ; only to compare
    70 00000072 663993[14000000]            cmp [matr + ebx], dx
    71 00000079 7C06                        jl skipAdding
    72 0000007B 0383[14000000]              add eax, [matr + ebx]
    73                                  skipAdding:
    74 00000081 83C302                      add ebx, 2
    75 00000084 E2E8                        loop loop_j
    76                                  
    77 00000086 59                          pop ecx
    78 00000087 3B05[44000000]              cmp eax, [bestQuantity]
    79 0000008D 7E13                        jle skipUpdateMax
    80 0000008F 66BA0500                    mov dx, 5
    81 00000093 6629CA                      sub dx, cx
    82                                      ; dx have index of optimal
    83 00000096 A3[44000000]                mov [bestQuantity], eax
    84 0000009B 668915[46000000]            mov [numberOfBest], dx
    85                                  
    86                                  skipUpdateMax:
    87 000000A2 E2BF                        loop loop_i
    88                                  
    89 000000A4 EB35                        jmp printNumberOfBestString
    90                                  
    91                                  
    92                                  printMatrix:
    93 000000A6 B918000000                  mov ecx, 24
    94 000000AB BB00000000                  mov ebx, 0
    95                                  cycle_write:
    96 000000B0 51                          push ecx
    97                                      ;convert elem of matr to string
    98 000000B1 BE[0A000000]                mov esi, OutBuf
    99 000000B6 668B83[14000000]            mov ax, [matr + ebx]
   100 000000BD 83C302                      add ebx, 2
   101 000000C0 53                          push ebx
   102 000000C1 98                          cwde
   103 000000C2 E8(55000000)                call IntToStr
   104                                  
   105                                      ;print output 
   106 000000C7 89F1                        mov ecx, esi
   107 000000C9 89C2                        mov edx, eax
   108 000000CB B804000000                  mov eax, 4
   109 000000D0 BB01000000                  mov ebx, 1
   110 000000D5 CD80                        int 80h
   111                                      
   112 000000D7 5B                          pop ebx
   113 000000D8 59                          pop ecx
   114 000000D9 E2D5                        loop cycle_write
   115                                      
   116                                  
   117                                  printNumberOfBestString:
   118                                  
   119                                      ;write message
   120 000000DB B804000000                  mov eax, 4
   121 000000E0 BB01000000                  mov ebx, 1
   122 000000E5 B9[13000000]                mov ecx, outMes 
   123 000000EA BA35000000                  mov edx, lenOutMes
   124 000000EF CD80                        int 80h
   125                                  
   126                                      ;convert elem of matr to string
   127 000000F1 BE[0A000000]                mov esi, OutBuf
   128 000000F6 66A1[46000000]              mov ax, [numberOfBest]
   129 000000FC 98                          cwde
   130 000000FD E8(55000000)                call IntToStr
   131                                  
   132                                      ;print output 
   133 00000102 89F1                        mov ecx, esi
   134 00000104 89C2                        mov edx, eax
   135 00000106 B804000000                  mov eax, 4
   136 0000010B BB01000000                  mov ebx, 1
   137 00000110 CD80                        int 80h
   138                                      
   139 00000112 EB00                        jmp printSumOfBestString
   140                                  
   141                                  printSumOfBestString:
   142                                  
   143                                      ;write message
   144 00000114 B804000000                  mov eax, 4
   145 00000119 BB01000000                  mov ebx, 1
   146 0000011E B9[48000000]                mov ecx, outMesSum
   147 00000123 BA19000000                  mov edx, lenOutMesSum
   148 00000128 CD80                        int 80h
   149                                  
   150                                      ;convert elem of matr to string
   151 0000012A BE[0A000000]                mov esi, OutBuf
   152 0000012F 66A1[44000000]              mov ax, [bestQuantity]
   153 00000135 98                          cwde
   154 00000136 E8(55000000)                call IntToStr
   155                                  
   156                                      ;print output 
   157 0000013B 89F1                        mov ecx, esi
   158 0000013D 89C2                        mov edx, eax
   159 0000013F B804000000                  mov eax, 4
   160 00000144 BB01000000                  mov ebx, 1
   161 00000149 CD80                        int 80h
   162                                      
   163 0000014B EB18                        jmp exit
   164                                  
   165                                  
   166                                  errorMessage:
   167 0000014D B804000000                  mov eax, 4
   168 00000152 BB01000000                  mov ebx, 1
   169 00000157 B9[61000000]                mov ecx, errorGetElem
   170 0000015C BA1A000000                  mov edx, lenErrorGetElem
   171 00000161 CD80                        int 80h
   172 00000163 EB00                        jmp exit
   173                                  
   174                                  exit:
   175                                      ; exit
   176 00000165 B801000000                  mov eax, 1
   177 0000016A 31DB                        xor ebx, ebx
   178 0000016C CD80                        int 80h
   179                                  
   180                                  %include "../int_string.asm"
     1                              <1>     section _text
     2                              <1> StrToInt:
     3 00000000 57                  <1>     push   edi
     4 00000001 B739                <1>     mov    bh, '9'
     5 00000003 B330                <1>     mov    bl, '0'
     6 00000005 56                  <1>     push   esi     ;
     7 00000006 803E2D              <1>     cmp    byte[esi], '-'
     8 00000009 7501                <1>     jne   .prod
     9 0000000B 46                  <1>     inc    esi     ;
    10 0000000C FC                  <1> .prod cld
    11 0000000D 6631FF              <1>     xor    di, di  ; 
    12 00000010 AC                  <1> .cycle: lodsb          ; ��������� ������ (�����)
    13 00000011 3C0A                <1>     cmp    al, 10  ; ���� 10, �� �� �����
    14 00000013 741F                <1>     je     .Return
    15 00000015 38D8                <1>     cmp    al, bl  ; ���������� � ����� ����
    16 00000017 722F                <1>     jb     .Error  ; "����" � ������
    17 00000019 38F8                <1>     cmp    al, bh  ; ���������� � ����� ������ 
    18 0000001B 772B                <1>     ja     .Error  ; "����" � ������
    19 0000001D 2C30                <1>     sub    al, 30h ; �������� ����� �� �������
    20 0000001F 6698                <1>     cbw            ; ��������� �� �����
    21 00000021 6650                <1>     push   ax      ; ��������� � �����
    22 00000023 66B80A00            <1>     mov    ax, 10  ; ������� 10 � AX
    23 00000027 66F7E7              <1>     mul    di      ; ��������, ��������� � DX:AX
    24 0000002A 665F                <1>     pop    di      ; � DI � ��������� �����
    25 0000002C 6601F8              <1>     add    ax, di
    26 0000002F 6689C7              <1>     mov    di, ax  ; � DI � ����������� �����        
    27 00000032 EBDC                <1>     jmp    .cycle
    28 00000034 5E                  <1> .Return: pop    esi
    29 00000035 BB00000000          <1>     mov    ebx, 0
    30 0000003A 803E2D              <1>     cmp    byte[esi], '-'
    31 0000003D 7503                <1>     jne    .J
    32 0000003F 66F7DF              <1>     neg    di
    33 00000042 6689F8              <1> .J  mov    ax, di
    34 00000045 98                  <1>     cwde
    35 00000046 EB0B                <1>     jmp    .R
    36 00000048 5E                  <1> .Error: pop    esi
    37 00000049 B800000000          <1>     mov    eax, 0
    38 0000004E BB01000000          <1>     mov    ebx, 1
    39 00000053 5F                  <1> .R       pop    edi
    40 00000054 C3                  <1>     ret
    41                              <1> IntToStr: 
    42 00000055 57                  <1>     push   edi
    43 00000056 53                  <1>     push   ebx
    44 00000057 52                  <1>     push   edx
    45 00000058 51                  <1>     push   ecx
    46 00000059 56                  <1>     push   esi
    47 0000005A C60600              <1>     mov    byte[esi],0 ; �� ����� �����
    48 0000005D 83F800              <1>     cmp    eax,0
    49 00000060 7D05                <1>     jge    .l1
    50 00000062 F7D8                <1>     neg    eax
    51 00000064 C6062D              <1>     mov    byte[esi],'-'
    52 00000067 C646060A            <1> .l1 mov    byte[esi+6],10
    53 0000006B BF05000000          <1>     mov    edi,5
    54 00000070 66BB0A00            <1>     mov    bx,10
    55 00000074 6699                <1> .again: cwd           ; ��������� ����� �� ��������
    56 00000076 66F7F3              <1>     div    bx     ; ����� ��������� �� 10
    57 00000079 80C230              <1>     add    dl,30h ; �������� �� ������� ��� �����
    58 0000007C 88143E              <1>     mov    [esi+edi],dl ; ����� ������ � ������
    59 0000007F 4F                  <1>     dec    edi    ; ��������� ��������� ��  
    60                              <1>                 ; ���������� �������
    61 00000080 6683F800            <1>     cmp    ax, 0  ; ������������� ��� �����?
    62 00000084 75EE                <1>     jne    .again
    63 00000086 B906000000          <1>     mov    ecx, 6
    64 0000008B 29F9                <1>     sub    ecx, edi ; ����� ����������+����
    65 0000008D 89C8                <1>     mov    eax,ecx
    66 0000008F 40                  <1>     inc    eax      ; ����� ����������+0�
    67 00000090 46                  <1>     inc    esi      ; ���������� ����
    68 00000091 56                  <1>     push   esi
    69 00000092 8D343E              <1>     lea    esi,[esi+edi] ; ������ ����������
    70 00000095 5F                  <1>     pop    edi
    71 00000096 F3A4                <1>     rep movsb
    72 00000098 5E                  <1>     pop    esi  
    73 00000099 59                  <1>     pop    ecx
    74 0000009A 5A                  <1>     pop    edx
    75 0000009B 5B                  <1>     pop    ebx
    76 0000009C 5F                  <1>     pop    edi
    77 0000009D C3                  <1>     ret
